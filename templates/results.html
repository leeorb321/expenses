{% extends "layout.html" %}
{% block title %}Display Data{% endblock %}


{% block content %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment.js"></script>
  <div class=page>
  <h1>Display Data</h1>
    <div class=new-expense>

      <table border="1" id="datatable"><tr>
          <th id="date">Transaction Date</th>
          <th id="amount">Amount</th>
          <th id="category">Category</th>
          <th>Description</th>
          <th id="person">Person</th>
          </tr>

      </table>
      <p>Total: {{ "${:.2f}".format(total) }}</p>
    </div>
  </div>

  <script>
    var expensesData = {{data|tojson}};
    // console.log(allData);

    function drawTable(allData) {
        for (var i = 0; i < allData.length; i++) {
            drawRow(allData[i]);
        }
    }

    function drawRow(rowData) {
        var row = $("<tr>")
        var fDate = new Date((rowData.date).substring(0,(rowData.date).length - 4)).toLocaleDateString("en-US");
        row.append($("<td>" + fDate + "</td>"));
        row.append($("<td>$" + rowData.amount + "</td>"));
        row.append($("<td>" + rowData.category + "</td>"));
        row.append($("<td>" + rowData.description + "</td>"));
        row.append($("<td>" + rowData.person + "</td></tr>"));
        $("#datatable tbody").append(row);

    }

    drawTable(expensesData);

    document.getElementById("amount").onclick = function() {

      var sortedByAmount = expensesData.sort(function(a,b) {
        return parseFloat(a.amount) - parseFloat(b.amount);
      });

      drawTable(sortedByAmount);

    }


  </script>


{% endblock %}
